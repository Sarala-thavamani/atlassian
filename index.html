<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira Issue Creator</title>
</head>
<body>
    <h2>Create Jira Issue</h2>
    
    <!-- API token input -->
    <label for="api-token">Enter your Jira API Token:</label>
    <input type="text" id="api-token" placeholder="Enter your API token">
    
    <button id="push-to-jira-btn">Create Jira Issue</button>
    
    <script>
        document.getElementById("push-to-jira-btn").addEventListener("click", function () {
            // Get the API token input by the user
            const apiToken = document.getElementById("api-token").value;
            
            if (!apiToken) {
                alert("Please provide an API token.");
                return;
            }

            const authToken = btoa("apiuser@vistrivetech.com:" + apiToken);

            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", "Basic " + authToken);
            myHeaders.append("Cookie", "atlassian.xsrf.token=99a5198e1ef313d231ba9b49bc7abac577da4f27_lin");

            const raw = JSON.stringify({
                "fields": {
                    "description": {
                        "content": [
                            {
                                "content": [
                                    {
                                        "text": "test",
                                        "type": "text"
                                    }
                                ],
                                "type": "paragraph"
                            }
                        ],
                        "type": "doc",
                        "version": 1
                    },
                    "issuetype": {
                        "id": "10016" // Update this to the correct issue type ID
                    },
                    "project": {
                        "id": "10005" // Update this to the correct project ID
                    },
                    "summary": "test1"
                }
            });

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
                redirect: "follow"
            };

            // Send the request to the Jira API
            fetch("https://cn2.atlassian.net/rest/api/3/issue", requestOptions)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`Error: ${response.status} - ${response.statusText}`);
                    }
                    return response.json(); // Parse JSON response
                })
                .then((result) => {
                    console.log("Issue created successfully:", result);
                    alert("Issue created successfully with ID: " + result.key);
                })
                .catch((error) => {
                    console.error("Error creating issue:", error);
                    alert("Failed to create issue. Error: " + error);
                });
        });
    </script>
</body>
</html>
